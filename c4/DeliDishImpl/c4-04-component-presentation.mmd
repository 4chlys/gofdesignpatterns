graph TB
    subgraph External["External Clients"]
        WebBrowser["<b>Web Browser</b><br/>[Client]<br/><br/>Voor restaurants:<br/>Menu beheer, bestellingen<br/><br/>Voor klanten:<br/>Browsen, bestellen"]
        MobileApp["<b>Mobile App</b><br/>[Client]<br/><br/>Voor koeriers:<br/>Opdrachten accepteren,<br/>Status updates"]
    end
    
    subgraph PresentationLayer["<b>PRESENTATION LAYER</b>"]
        Controller["<b>BestellingController</b><br/>[Spring @RestController]<br/><br/><b>Attributes:</b><br/>- bestellingService: BestellingService<br/>- mailKoerier: String<br/><br/><b>REST Endpoints:</b><br/>GET /beschikbare-leveringen<br/>POST /accepteer-opdracht/{id}<br/><br/><b>Responsibilities:</b><br/>• HTTP request handling<br/>• Input validation<br/>• Response formatting (JSON)<br/>• Error handling<br/>• Session management"]
        
        subgraph ControllerMethods["Controller Methods"]
            Method1["<b>setMailKoerier(String)</b><br/>Set koerier context<br/>for current session"]
            Method2["<b>geefBeschikbareLeveringen(Position)</b><br/>Returns: List&lt;Bestelling&gt;<br/><br/>Get available orders for koerier<br/>based on their position"]
            Method3["<b>kiesBezorging(int)</b><br/>Returns: Bestelling<br/><br/>Accept delivery assignment<br/>Updates bestelling status"]
        end
    end
    
    subgraph BusinessLayer["<b>BUSINESS LAYER</b>"]
        BestellingService["<b>BestellingService</b><br/>[Spring @Service]<br/><br/><b>Methods:</b><br/>+ getBeschikbareLeveringen()<br/>+ accepteerOpdracht()<br/>+ addOrder()<br/>+ getOrdersByStatus()"]
        
        PersoonService["<b>PersoonService</b><br/>[Spring @Service]<br/><br/><b>Methods:</b><br/>+ getKoerier(String)<br/>+ updateKoerier(Koerier)<br/>+ recordDeliveryPoint()"]
    end
    
    subgraph ExternalAPIs["<b>EXTERNAL APIS</b>"]
        GoogleMaps["<b>Google Maps API</b><br/>[External Service]<br/><br/><b>Used for:</b><br/>• Geocoding adressen<br/>• OAuth authentication<br/><br/><b>Protocol:</b> HTTPS/REST"]
        
        Ingenico["<b>Ingenico API</b><br/>[External Service]<br/><br/><b>Used for:</b><br/>• Payment processing<br/>• 70% to restaurant<br/>• 30% to DeliDish<br/><br/><b>Protocol:</b> HTTPS/REST"]
        
        Facebook["<b>Facebook API</b><br/>[External Service]<br/><br/><b>Used for:</b><br/>• OAuth authentication<br/><br/><b>Protocol:</b> HTTPS/REST"]
    end
    
    %% External to Controller
    WebBrowser -->|"HTTP GET/POST<br/>JSON requests"| Controller
    MobileApp -->|"HTTP GET/POST<br/>JSON requests"| Controller
    
    %% Controller Methods
    Controller -.->|"Contains"| Method1
    Controller -.->|"Contains"| Method2
    Controller -.->|"Contains"| Method3
    
    %% Controller to Business Services
    Controller -->|"Delegates business logic"| BestellingService
    Controller -->|"Get koerier info"| PersoonService
    
    %% Controller to External APIs
    Controller -->|"Geocode restaurant address<br/>HTTPS"| GoogleMaps
    Controller -->|"Process payments<br/>HTTPS"| Ingenico
    Controller -->|"OAuth login<br/>HTTPS"| Facebook
    
    %% Response flow
    BestellingService -.->|"Returns List&lt;Bestelling&gt;"| Controller
    PersoonService -.->|"Returns Koerier"| Controller
    Controller -.->|"JSON Response<br/>HTTP 200/400/500"| WebBrowser
    Controller -.->|"JSON Response<br/>HTTP 200/400/500"| MobileApp
    
    style Controller fill:#ff9999,stroke:#cc0000,color:#000000,stroke-width:3px
    style Method1 fill:#ffcccc,stroke:#cc0000,color:#000000
    style Method2 fill:#ffcccc,stroke:#cc0000,color:#000000
    style Method3 fill:#ffcccc,stroke:#cc0000,color:#000000
    style BestellingService fill:#85bbf0,stroke:#5d82a8,color:#000000,stroke-width:2px
    style PersoonService fill:#85bbf0,stroke:#5d82a8,color:#000000,stroke-width:2px
    style GoogleMaps fill:#999999,stroke:#6b6b6b,color:#ffffff
    style Ingenico fill:#999999,stroke:#6b6b6b,color:#ffffff
    style Facebook fill:#999999,stroke:#6b6b6b,color:#ffffff
    style WebBrowser fill:#f0f0f0,stroke:#666,color:#000000
    style MobileApp fill:#f0f0f0,stroke:#666,color:#000000
    style PresentationLayer fill:#ffe6e6,stroke:#cc0000,stroke-width:3px
    style BusinessLayer fill:#e6f3ff,stroke:#0066cc,stroke-width:2px
    style ExternalAPIs fill:#f5f5f5,stroke:#999,stroke-width:2px
    
    subgraph Legend[" "]
        L1["Controller = HTTP endpoint handler"]
        L2["Service = Business logic"]
        L3["External API = Third-party"]
        L4["Solid line = Synchronous call"]
        L5["Dashed line = Contains/Returns"]
    end
    
    style Legend fill:#ffffff,stroke:#333,stroke-width:2px
    style L1 fill:#ff9999,stroke:#cc0000,color:#000000
    style L2 fill:#85bbf0,stroke:#5d82a8,color:#000000
    style L3 fill:#999999,stroke:#6b6b6b,color:#ffffff
    style L4 fill:#ffffff,stroke:#333,color:#000000
    style L5 fill:#ffffff,stroke:#333,color:#000000,stroke-dasharray: 5 5